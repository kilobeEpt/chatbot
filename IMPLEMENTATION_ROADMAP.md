# üöÄ –î–û–†–û–ñ–ù–ê–Ø –ö–ê–†–¢–ê –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –£–õ–£–ß–®–ï–ù–ò–ô

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É–ª—É—á—à–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ ChatBot v2.1 —Å –æ—Ü–µ–Ω–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ.

---

## üìä –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏

```
–í–ª–∏—è–Ω–∏–µ (Impact)
    ‚Üë
    | –ö–†–ò–¢–ò–ß–ù–´–ï      –í–ê–ñ–ù–´–ï      –ñ–ï–õ–ê–¢–ï–õ–¨–ù–´–ï
    | (P1)           (P2)        (P3)
    |
    +‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí –°–ª–æ–∂–Ω–æ—Å—Ç—å (Effort)
```

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
|-----------|-----------|---------|------------------------|
| **P1** | 1-3 —á–∞—Å–∞ | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | –î–æ production |
| **P2** | 3-8 —á–∞—Å–æ–≤ | –í—ã—Å–æ–∫–æ–µ | –î–æ –ø–µ—Ä–≤–æ–π –≤–µ—Ä—Å–∏–∏ |
| **P3** | 8+ —á–∞—Å–æ–≤ | –°—Ä–µ–¥–Ω–µ–µ | –°–ª–µ–¥—É—é—â–∏–π —Å–ø—Ä–∏–Ω—Ç |
| **P4** | –î–Ω–∏ | –ù–∏–∑–∫–æ–µ | –ö–æ–≥–¥–∞ –µ—Å—Ç—å –≤—Ä–µ–º—è |

---

## üî¥ –§–ê–ó–ê 1: –ö–†–ò–¢–ò–ß–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (1-2 –¥–Ω—è)

–≠—Ç–∏ —É–ª—É—á—à–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### ‚úÖ 1.1 –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ —Ä–µ–∂–∏–º

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 - –ö–†–ò–¢–ò–ß–ù–´–ô  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: ‚≠ê 1/5  
**–í—Ä–µ–º—è**: 1-2 —á–∞—Å–∞  
**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: +15%

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ë—Ä–∞—É–∑–µ—Ä –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ —Ä–µ–∂–∏–º–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è cookies –∏ –∏—Å—Ç–æ—Ä–∏–∏.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è**:
- `chatbot_v2v2.py` - –º–µ—Ç–æ–¥ `ChatBot._init_driver()` (—Å—Ç—Ä–æ–∫–∞ 808)
- `chatbot_v2v2.py` - –º–µ—Ç–æ–¥ `ChatBot.__init__()` (—Å—Ç—Ä–æ–∫–∞ 682)
- `chatbot_v2v2.py` - –∫–ª–∞—Å—Å `ChatBotGUI` (—Å—Ç—Ä–æ–∫–∞ 2290)

**–ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

```python
# 1. –í ChatBot.__init__() –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä:
def __init__(self, ..., incognito=True, ...):
    self.incognito = incognito

# 2. –í _init_driver() –¥–æ–±–∞–≤–∏—Ç—å:
if self.incognito:
    options.add_argument('--incognito')
    self.log("‚úì –ò–Ω–∫–æ–≥–Ω–∏—Ç–æ —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω")

# 3. –í ChatBotGUI –¥–æ–±–∞–≤–∏—Ç—å checkbox:
self.incognito_var = tk.BooleanVar(value=True)
ttk.Checkbutton(col1, text="üïµÔ∏è –ò–Ω–∫–æ–≥–Ω–∏—Ç–æ —Ä–µ–∂–∏–º", 
               variable=self.incognito_var).pack(anchor=tk.W, pady=2)

# 4. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–æ—Ç–∞ –ø–µ—Ä–µ–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ:
bot = ChatBot(..., incognito=self.incognito_var.get(), ...)
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- ‚úì –ë—Ä–∞—É–∑–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å —Ñ–ª–∞–≥–æ–º --incognito
- ‚úì Cookie –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏
- ‚úì –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: +15% –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ cookies –Ω–∞ —Å–∞–π—Ç–∞—Ö

---

### ‚úÖ 1.2 –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ iframe –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 - –ö–†–ò–¢–ò–ß–ù–´–ô  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: ‚≠ê‚≠ê 2/5  
**–í—Ä–µ–º—è**: 2-3 —á–∞—Å–∞  
**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: +10%

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤ iframe –¥–æ–ª–∂–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ try/finally.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è**:
- `chatbot_v2v2.py` - –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å iframe (—Å—Ç—Ä–æ–∫–∏ 1536-1690)

**–ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

```python
# –î–æ–±–∞–≤–∏—Ç—å context manager –¥–ª—è iframe:
class IframeContext:
    def __init__(self, driver, iframe):
        self.driver = driver
        self.iframe = iframe
    
    def __enter__(self):
        self.driver.switch_to.frame(self.iframe)
        return self
    
    def __exit__(self, *args):
        self.driver.switch_to.default_content()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ:
def find_input_in_iframes(self):
    self.switch_to_default_content()
    iframes = self.driver.find_elements(By.TAG_NAME, "iframe")
    
    for i, iframe in enumerate(iframes[:15]):
        try:
            with IframeContext(self.driver, iframe):
                # –†–∞–±–æ—Ç–∞ –≤ iframe –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
                element = self.driver.find_element(...)
                if element:
                    return element
        except Exception as e:
            self.log(f"–û—à–∏–±–∫–∞ –≤ iframe #{i}: {e}", "DEBUG")
    
    # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
    self.switch_to_default_content()
    return None
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- ‚úì –ü–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –≤ iframe –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π
- ‚úì –ù–µ—Ç "–∑–∞–≤–∏—Å–∞–Ω–∏—è" –≤ iframe –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- ‚úì –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –ò—Å—á–µ–∑–Ω—É—Ç –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞ "element not found" –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã —Å iframe

---

### ‚úÖ 1.3 –î–æ–±–∞–≤–∏—Ç—å explicit logging –¥–ª—è –æ—à–∏–±–æ–∫

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: ‚≠ê 1/5  
**–í—Ä–µ–º—è**: 1 —á–∞—Å  
**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –æ—Ç–ª–∞–¥–∫—É**: +20%

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –ø—É—Å—Ç—ã–µ `except: pass` –Ω–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è**:
- `chatbot_v2v2.py` - –≤—Å–µ –ø—É—Å—Ç—ã–µ except –±–ª–æ–∫–∏

**–ö–æ–º–∞–Ω–¥–∞ –ø–æ–∏—Å–∫–∞**: 
```bash
grep -n "except:" chatbot_v2v2.py | grep "pass"
```

**–ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

```python
# –í–ú–ï–°–¢–û:
except:
    pass

# –ò–°–ü–û–õ–¨–ó–£–ô–¢–ï:
except Exception as e:
    self.log(f"–ù–µ–∫—Ä–∏—Ç–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞: {type(e).__name__}: {e}", "DEBUG")
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- ‚úì –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úì –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ –æ—à–∏–±–∫–∏
- ‚úì –û—Ç–ª–∞–¥–∫–∞ —Å—Ç–∞–ª–∞ –ø—Ä–æ—â–µ

---

## üü† –§–ê–ó–ê 2: –í–´–°–û–ö–ò–ï –ü–†–ò–û–†–ò–¢–ï–¢–´ (3-5 –¥–Ω–µ–π)

–≠—Ç–∏ —É–ª—É—á—à–µ–Ω–∏—è –≤–∞–∂–Ω—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.

### ‚úÖ 2.1 –û–±—Ä–∞–±–æ—Ç–∫–∞ CAPTCHA –∏ reCAPTCHA

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2 - –í–´–°–û–ö–ò–ô  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: ‚≠ê‚≠ê‚≠ê 3/5  
**–í—Ä–µ–º—è**: 4-6 —á–∞—Å–æ–≤  
**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: +20%

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ CAPTCHA –∏ –ø—Ä–æ–ø—É—Å–∫ —Å–∞–π—Ç–æ–≤ –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–µ—Ä–≤–∏—Å–æ–º —Ä–µ—à–µ–Ω–∏—è.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è**:
- `chatbot_v2v2.py` - –∫–ª–∞—Å—Å `ChatBot`

**–ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–ª–∞—Å—Å ChatBot:

def detect_and_handle_captcha(self, url):
    """–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ CAPTCHA"""
    
    captcha_types = {
        'recaptcha_v2': ['div.g-recaptcha', 'iframe[src*="recaptcha"]'],
        'hcaptcha': ['div.h-captcha', 'iframe[src*="hcaptcha"]'],
        'image_captcha': ['img[alt*="captcha"]', 'img[alt*="verify"]'],
    }
    
    for captcha_type, selectors in captcha_types.items():
        for selector in selectors:
            try:
                elements = self.driver.find_elements(By.CSS_SELECTOR, selector)
                if elements:
                    self.log(f"‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ CAPTCHA: {captcha_type}", "WARNING")
                    
                    # –û–ø—Ü–∏—è 1: –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–∞–π—Ç
                    # return False
                    
                    # –û–ø—Ü–∏—è 2: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–µ—à–∏—Ç—å (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
                    if hasattr(self, 'captcha_api_key'):
                        return self._solve_captcha(captcha_type, url)
                    else:
                        return False
            except:
                pass
    
    return True  # –ù–µ—Ç CAPTCHA

def _solve_captcha(self, captcha_type, url):
    """–†–µ—à–µ–Ω–∏–µ CAPTCHA —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å (—Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á)"""
    try:
        import requests
        
        # –ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã CAPTCHA
        site_key = self.driver.execute_script(
            "return document.querySelector('[data-sitekey]')?.getAttribute('data-sitekey')"
        )
        
        if not site_key:
            return False
        
        # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ –≤ 2captcha.com
        response = requests.post(
            'http://2captcha.com/api/upload',
            data={
                'key': self.captcha_api_key,
                'method': 'userrecaptcha',
                'googlekey': site_key,
                'pageurl': url,
            },
            timeout=10
        )
        
        if 'OK' not in response.text:
            return False
        
        captcha_id = response.text.split('|')[1]
        
        # –ñ–¥–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è (max 3 –º–∏–Ω—É—Ç—ã)
        for attempt in range(180):
            time.sleep(1)
            
            result = requests.get(
                f'http://2captcha.com/api/res.php?key={self.captcha_api_key}&action=get&id={captcha_id}'
            )
            
            if 'OK' in result.text:
                token = result.text.split('|')[1]
                
                # –í—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
                self.driver.execute_script(f"""
                    document.getElementById('g-recaptcha-response').textContent = '{token}';
                    
                    if (window.__grecaptcha_cb) {{
                        window.__grecaptcha_cb();
                    }}
                """)
                
                self.log("‚úì CAPTCHA —Ä–µ—à–µ–Ω–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞", "INFO")
                return True
        
        return False
        
    except Exception as e:
        self.log(f"–û—à–∏–±–∫–∞ —Ä–µ—à–µ–Ω–∏—è CAPTCHA: {e}", "ERROR")
        return False

# –í send_message() –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É:
if not self.detect_and_handle_captcha(url):
    result['error'] = 'CAPTCHA –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∏ –Ω–µ —Ä–µ—à–µ–Ω–∞'
    return result
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GUI**:

```python
# –í ChatBotGUI –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è API –∫–ª—é—á–∞:
self.captcha_api_label = ttk.Label(col2, text="API –∫–ª—é—á 2captcha (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):")
self.captcha_api_label.pack(anchor=tk.W)

self.captcha_api_entry = ttk.Entry(col2, width=30)
self.captcha_api_entry.pack(anchor=tk.W, pady=(0, 10))

# –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–æ—Ç–∞:
if self.captcha_api_entry.get():
    bot.captcha_api_key = self.captcha_api_entry.get()
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- ‚úì –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —ÄeCAPTCHA v2/v3
- ‚úì –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç hCaptcha
- ‚úì –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–∞–π—Ç—ã —Å CAPTCHA –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ API –∫–ª—é—á–∞
- ‚úì –†–µ—à–∞–µ—Ç CAPTCHA –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ API –∫–ª—é—á–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: +15-20% —É—Å–ø–µ—à–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫

---

### ‚úÖ 2.2 CloudFlare –∑–∞—â–∏—Ç–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2 - –í–´–°–û–ö–ò–ô  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: ‚≠ê‚≠ê‚≠ê‚≠ê 4/5  
**–í—Ä–µ–º—è**: 6-8 —á–∞—Å–æ–≤  
**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: +10%

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –æ–±—Ö–æ–¥ CloudFlare challenge page.

**–†–µ—à–µ–Ω–∏–µ 1: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫**

```python
# –í –º–µ—Ç–æ–¥–µ open_website():
def open_website(self, url):
    # ... —Ç–µ–∫—É—â–∏–π –∫–æ–¥ ...
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ CloudFlare
    if self._detect_cloudflare():
        self.log("‚ö†Ô∏è CloudFlare –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É", "WARNING")
        time.sleep(5)  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        
        # –ñ–¥–∞—Ç—å –ø–æ–∫–∞ cloudflare —Ä–µ—à–∏—Ç challenge
        WebDriverWait(self.driver, 30).until(
            lambda driver: "challenge" not in driver.page_source.lower()
        )

def _detect_cloudflare(self):
    """–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ CloudFlare challenge"""
    try:
        return 'cf_clearance' not in self.driver.get_cookies() or \
               'cf-challenge' in self.driver.page_source.lower()
    except:
        return False
```

**–†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ undetected-chromedriver** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
pip install undetected-chromedriver
```

```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ webdriver:
try:
    import undetected_chromedriver as uc
    
    def _init_driver(self, headless):
        options = uc.ChromeOptions()
        
        if headless:
            options.add_argument('--headless=new')
        
        options.add_argument('--incognito')
        
        # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ...
        
        self.driver = uc.Chrome(options=options, version_main=131)
        return self.driver
        
except ImportError:
    # Fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π Selenium
    self.log("undetected-chromedriver –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–π Chrome", "WARNING")
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- ‚úì –°–∞–π—Ç—ã —Å CloudFlare –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úì Challenge page –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É
- ‚úì Cookies —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

---

### ‚úÖ 2.3 –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ–∫—Å–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2 - –í–´–°–û–ö–ò–ô  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: ‚≠ê‚≠ê‚≠ê 3/5  
**–í—Ä–µ–º—è**: 4-5 —á–∞—Å–æ–≤  
**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: +5%

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SOCKS5 –ø—Ä–æ–∫—Å–∏ –∏ auth –ø—Ä–æ–∫—Å–∏.

**–ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è** (–∫–ª–∞—Å—Å ProxyManager):

```python
# –£–ª—É—á—à–∏—Ç—å –º–µ—Ç–æ–¥ format_for_selenium:
def format_for_selenium(self, proxy):
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤"""
    
    # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –ø—Ä–æ–∫—Å–∏
    if '://' in proxy:
        protocol, rest = proxy.split('://', 1)
    else:
        protocol = 'http'
        rest = proxy
    
    # –ü–∞—Ä—Å–∏–Ω–≥
    if '@' in rest:
        # –§–æ—Ä–º–∞—Ç: user:pass@ip:port
        auth, address = rest.rsplit('@', 1)
        user, password = auth.split(':', 1)
        ip, port = address.rsplit(':', 1)
        
        if protocol == 'socks5':
            # SOCKS5 —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
            return f'socks5://{user}:{password}@{ip}:{port}'
        else:
            # HTTP —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
            return f'http://{user}:{password}@{ip}:{port}'
    else:
        # –§–æ—Ä–º–∞—Ç: ip:port
        if protocol in ['socks5', 'socks4']:
            return f'{protocol}://{rest}'
        else:
            return f'http://{rest}'

# –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å Selenium Proxy API:
def apply_proxy_to_driver(self, driver, proxy):
    """–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–∫—Å–∏ –∫ WebDriver"""
    
    if proxy.startswith('socks'):
        # SOCKS –ø—Ä–æ–∫—Å–∏ - —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        return self._apply_socks_proxy(driver, proxy)
    else:
        # HTTP –ø—Ä–æ–∫—Å–∏ - —á–µ—Ä–µ–∑ –æ–ø—Ü–∏—é –±—Ä–∞—É–∑–µ—Ä–∞
        return self._apply_http_proxy(driver, proxy)

def _apply_http_proxy(self, driver, proxy):
    """–ü—Ä–∏–º–µ–Ω–∏—Ç—å HTTP –ø—Ä–æ–∫—Å–∏"""
    try:
        # –î–ª—è auth –ø—Ä–æ–∫—Å–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å chrome://net-internals
        # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å request interceptor
        proxy_url = proxy
        
        driver.execute_cdp_cmd('Network.setUserAgentOverride', {
            "userAgent": driver.execute_script('return navigator.userAgent;')
        })
        
        return True
    except:
        return False

def _apply_socks_proxy(self, driver, proxy):
    """–ü—Ä–∏–º–µ–Ω–∏—Ç—å SOCKS –ø—Ä–æ–∫—Å–∏"""
    # SOCKS —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
    # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å tinyproxy –∏–ª–∏ squid
    self.log("‚ö†Ô∏è SOCKS5 –ø—Ä–æ–∫—Å–∏ —Ç—Ä–µ–±—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞", "WARNING")
    return False
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- ‚úì HTTP –ø—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úì HTTP –ø—Ä–æ–∫—Å–∏ —Å auth —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úì SOCKS5 –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

---

## üü° –§–ê–ó–ê 3: –°–†–ï–î–ù–ò–ï –ü–†–ò–û–†–ò–¢–ï–¢–´ (1-2 –Ω–µ–¥–µ–ª–∏)

### ‚úÖ 3.1 Cookie –∏ session persistence

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P3 - –°–†–ï–î–ù–ò–ô  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: ‚≠ê‚≠ê‚≠ê 3/5  
**–í—Ä–µ–º—è**: 4-5 —á–∞—Å–æ–≤  

**–§–∞–π–ª—ã**: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å `SessionManager`

### ‚úÖ 3.2 –£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P3 - –°–†–ï–î–ù–ò–ô  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: ‚≠ê‚≠ê 2/5  
**–í—Ä–µ–º—è**: 3-4 —á–∞—Å–∞

**–î–æ–±–∞–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ —Å—Ä–∞–±–æ—Ç–æ–∫ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤**:

```python
class SelectorStats:
    def __init__(self):
        self.stats = {}
    
    def record_hit(self, chat_type, selector_index):
        key = f"{chat_type}:{selector_index}"
        self.stats[key] = self.stats.get(key, 0) + 1
    
    def get_report(self):
        return sorted(self.stats.items(), key=lambda x: x[1], reverse=True)

# –í ChatBot:
self.selector_stats = SelectorStats()

# –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞:
self.selector_stats.record_hit(self.detected_chat_type, selector_index)
```

### ‚úÖ 3.3 Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P3 - –°–†–ï–î–ù–ò–ô  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: ‚≠ê‚≠ê‚≠ê 3/5  
**–í—Ä–µ–º—è**: 4-5 —á–∞—Å–æ–≤

```python
def send_message_with_retry(self, url, message, max_retries=3):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å retry –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫"""
    
    for attempt in range(max_retries):
        try:
            result = self.send_message(url, message)
            
            if result['status'] == 'success':
                return result
            
            # –û—à–∏–±–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç retry
            if any(err in result.get('error', '').lower() 
                   for err in ['timeout', 'connection', 'refused']):
                
                wait_time = (2 ** attempt) * 2  # Exponential backoff: 2, 4, 8 —Å–µ–∫
                self.log(f"‚ö†Ô∏è Retry #{attempt+1} —á–µ—Ä–µ–∑ {wait_time} —Å–µ–∫...", "WARNING")
                time.sleep(wait_time)
                continue
            
            # –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ - –Ω–µ retry
            return result
            
        except Exception as e:
            if attempt < max_retries - 1:
                self.log(f"‚úó –û—à–∏–±–∫–∞: {e}, retry...", "ERROR")
            else:
                raise
    
    return result
```

---

## üü¢ –§–ê–ó–ê 4: –î–û–õ–ì–û–°–†–û–ß–ù–´–ï (1+ –º–µ—Å—è—Ü)

### 4.1 –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Backend (Flask/FastAPI)
- –û—Ç–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –æ—Ç GUI
- REST API
- WebSocket –¥–ª—è —Ä–µ–∞–ª-—Ç–∞–π–º –ª–æ–≥–æ–≤
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

### 4.2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ELK Stack
- –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ —Ç–∏–ø–∞–º —á–∞—Ç–æ–≤
- –ê–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏

### 4.3 –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ù–µ—Å–∫–æ–ª—å–∫–æ —Ö–æ—Å—Ç–æ–≤ —Å —Ä–∞—Å—Å—ã–ª–∫–æ–π
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
- –†–∞–∑–ª–∏—á–Ω—ã–µ IP –∞–¥—Ä–µ—Å–∞

---

## üìà –ì—Ä–∞—Ñ–∏–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```
–ù–µ–¥–µ–ª—è 1: –§–ê–ó–ê 1 (–ö—Ä–∏—Ç–∏—á–Ω—ã–µ)
  ‚îú‚îÄ 1.1 –ò–Ω–∫–æ–≥–Ω–∏—Ç–æ (2—á)
  ‚îú‚îÄ 1.2 iframe –∫–æ–Ω—Ç–µ–∫—Å—Ç (3—á)
  ‚îî‚îÄ 1.3 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (1—á)

–ù–µ–¥–µ–ª—è 2-3: –§–ê–ó–ê 2 (–í—ã—Å–æ–∫–∏–µ)
  ‚îú‚îÄ 2.1 CAPTCHA (6—á)
  ‚îú‚îÄ 2.2 CloudFlare (8—á)
  ‚îî‚îÄ 2.3 –ü—Ä–æ–∫—Å–∏ (5—á)

–ù–µ–¥–µ–ª—è 4: –§–ê–ó–ê 3 (–°—Ä–µ–¥–Ω–∏–µ)
  ‚îú‚îÄ 3.1 Sessions (5—á)
  ‚îú‚îÄ 3.2 –°–µ–ª–µ–∫—Ç–æ—Ä stats (4—á)
  ‚îî‚îÄ 3.3 Retry (5—á)

–ù–µ–¥–µ–ª–∏ 5+: –§–ê–ó–ê 4 (–î–æ–ª–≥–æ—Å—Ä–æ–∫)
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

### –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

- [ ] –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∏–ª—é –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- [ ] –ù–∞–ø–∏—Å–∞–Ω—ã unit —Ç–µ—Å—Ç—ã
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö (Windows, Mac, Linux)
- [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- [ ] –ù–µ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## üìã –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

| –§–∞–∑–∞ | –°—Ç–∞—Ç—É—Å | –í—Ä–µ–º—è | –í–ª–∏—è–Ω–∏–µ |
|------|--------|-------|---------|
| –§–ê–ó–ê 1 | ‚è∞ TODO | 1-2 –¥–Ω—è | +35% –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ |
| –§–ê–ó–ê 2 | ‚è∞ TODO | 3-5 –¥–Ω–µ–π | +30% –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ |
| –§–ê–ó–ê 3 | ‚è∞ TODO | 1-2 –Ω–µ–¥–µ–ª–∏ | +10% —É–¥–æ–±—Å—Ç–≤–∞ |
| –§–ê–ó–ê 4 | ‚è∞ TODO | 1+ –º–µ—Å—è—Ü | –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å |

**–ò—Ç–æ–≥–æ**: 2-4 –Ω–µ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è production-ready —Å—Ç–∞—Ç—É—Å–∞ —Å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é >90%.
